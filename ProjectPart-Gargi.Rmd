---
title: "Project"
author: "Gargi Singh"
date: "November 29, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# setting up the libraries
# require(caTools)
#Load packages
# install.packages('ggrepel')
# install.packages('dplyr')
library(plyr)
library(dplyr)
library(ggplot2)
library(ggrepel)
library(scales)
library(gdata)
library(car)
library(caret)
library(caTools)
library(ggbiplot,vqv)
```

```{r}
# setting the working directory

setwd('C:/Users/gogs/Documents/GitHub/MovieScorePredictor/Data')
#setwd('/Users/kkiran/Desktop/fall_2016/fds/project/MovieScorePredictor/data/')
Movie.Data = read.csv("cleanedMovieData.csv")
# head(Movie.Data)
```


```{r}
# assumption that the currency is in USD
#top 20 directors and 20 actors




Movie.Data.directors.20$profitPerMovie <- Movie.Data.directors.20$profit/Movie.Data.directors.20$films

Movie.Data.1.actors.20 <- Movie.Data %>% group_by(actor_1_name) %>% select(actor_1_name, budget, gross,profits) %>% na.omit() %>% summarise(films = n(), budget = sum(as.numeric(budget)), gross = sum(as.numeric(gross)), profit = sum(as.numeric(profits))) %>% arrange(desc(profit)) %>% top_n(50, profit)

Movie.Data.1.actors.20$profitPerMovie <- Movie.Data.1.actors.20$profit/Movie.Data.1.actors.20$films


Movie.Data.2.actors.20 <- Movie.Data %>% group_by(actor_2_name) %>% select(actor_2_name, budget, gross,profits) %>% na.omit() %>% summarise(films = n(), budget = sum(as.numeric(budget)), gross = sum(as.numeric(gross)), profit = sum(as.numeric(profits))) %>% arrange(desc(profit)) %>% top_n(50, profit)

Movie.Data.2.actors.20$profitPerMovie <- Movie.Data.2.actors.20$profit/Movie.Data.2.actors.20$films


Movie.Data.3.actors.20 <- Movie.Data %>% group_by(actor_3_name) %>% select(actor_3_name, budget, gross,profits) %>% na.omit() %>% summarise(films = n(), budget = sum(as.numeric(budget)), gross = sum(as.numeric(gross)), profit = sum(as.numeric(profits))) %>% arrange(desc(profit)) %>% top_n(50, profit)

Movie.Data.3.actors.20$profitPerMovie <- Movie.Data.3.actors.20$profit/Movie.Data.3.actors.20$films

```

```{r}
# combining the three lists to get the top 20/50 actors
colnames(Movie.Data.1.actors.20)[1] <- 'actorName'
colnames(Movie.Data.2.actors.20)[1] <- 'actorName'
colnames(Movie.Data.3.actors.20)[1] <- 'actorName'
combinedList <- rbind(Movie.Data.1.actors.20, Movie.Data.2.actors.20, Movie.Data.3.actors.20)
sortedCombinedList <- combinedList[order(-combinedList$profitPerMovie),]
```


```{r}
# combining all the three names into a big string for string matching

Movie.Data$combinedNames = paste(Movie.Data$actor_1_name, Movie.Data$actor_2_name,Movie.Data$actor_3_name, sep="_")
```

```{r}
top.50.names <- as.list(sortedCombinedList[,"actorName"])
length(top.50.names$actorName)
top.50.names <- top.50.names$actorName[1:150]
top.50.names


# now we need to find all the movies in which these top 50 actors acted
top.50.names <- as.vector(top.50.names)
names <- as.vector(Movie.Data$combinedNames)
```


```{r}
nameVector <- c("mainActor")
newdataframe <- Movie.Data[0,]
newdataframe <- rbind(newdataframe, Movie.Data[1,])
newdataframe[,nameVector] <- NA
newdataframe <- newdataframe[,c(51,1:50)]
class(newdataframe)
newdataframe
newdataframe[1,1] <- "abcd"
total <- 0

 for (i in 1: length(top.50.names)) {
  singleName <- as.character(top.50.names[i])
  counter <- 0
  for(j in 1 : length(names)) {
    if(grepl(singleName, names[j])) {
      # movie i is related to this actor
      fulldetails <- c(as.character(singleName), Movie.Data[j,])
      names(fulldetails)[1] <- "mainActor"
      newdataframe <- rbind(newdataframe, fulldetails)
      counter <- counter + 1
    } 
  }
  total <- total + counter
   print(c(i, "-->", singleName,"-->", counter))
 }

newdataframe <- newdataframe[-1,]
print(total)
write.csv(newdataframe, file = "dataPerActor.csv")

newdataframe <- newdataframe[,1: length(newdataframe) - 1]
colnames(newdataframe)[2] <- "movieNumber"
```


```{r}
# calculating a unified score for all the movies to give them a rank
newdataframe$score <- ( 0.1 * (newdataframe$actor_1_facebook_likes + newdataframe$actor_2_facebook_likes + newdataframe$actor_3_facebook_likes + newdataframe$director_facebook_likes + newdataframe$movie_facebook_likes ) + 0.1 * newdataframe$profits + ((newdataframe$tomatoUserReviews/newdataframe$tomatoReviews) * 10 *(newdataframe$tomatoFresh - newdataframe$tomatoRotten) /(newdataframe$num_user_for_reviews * ( newdataframe$tomatoRating -  newdataframe$tomatoUserRating))))/ newdataframe$num_voted_users

newdataframe$score <- as.integer(newdataframe$score)
newdataframe %>% mutate_each_(funs(scale),vars=newdataframe$score) 

row.has.na <- apply(newdataframe, 1, function(x){any(is.na(x))})
numberOfNAs <- sum(row.has.na)
numberOfNAs
newdataframe <- na.omit(newdataframe)
newdataframe[2,51] <- 87
newdataframe[3,51] <- 37

min(newdataframe$score)
mean(newdataframe$score)
sd(newdataframe$score)
max(newdataframe$score)

newdataframe$scoreCAT <- cut(newdataframe$score ,c(-15495, -10, 0,  50, 100, 150, 200, 250,500,750,1018))
newdataframe$scoreLabel <- cut(newdataframe$score, seq(0, 1018, -15495), right = FALSE, labels = c('A','B','C','D','E','F','G','H','I','J'))
```